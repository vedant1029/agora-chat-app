(()=>{var e,n;function t(e,n){o("https://a41.chat.agora.io/app/chat/user/login",{userAccount:e,userPassword:n}).then((e=>{let n=e.accessToken;WebIM.conn.renewToken(n),document.getElementById("log").appendChild(document.createElement("div")).append("Token has been updated")}))}function o(e,n){return fetch(e,{body:JSON.stringify(n),cache:"no-cache",headers:{"content-type":"application/json"},method:"POST",mode:"cors",redirect:"follow",referrer:"no-referrer"}).then((e=>e.json()))}WebIM.conn=new WebIM.connection({appKey:"41117440#383391"}),WebIM.conn.addEventHandler("connection&message",{onConnected:()=>{document.getElementById("log").appendChild(document.createElement("div")).append("Connect success !")},onDisconnected:()=>{document.getElementById("log").appendChild(document.createElement("div")).append("Logout success !")},onTextMessage:e=>{console.log(e),document.getElementById("log").appendChild(document.createElement("div")).append("Message from: "+e.from+" Message: "+e.msg)},onTokenWillExpire:o=>{document.getElementById("log").appendChild(document.createElement("div")).append("Token is about to expire"),t(e,n)},onTokenExpired:o=>{document.getElementById("log").appendChild(document.createElement("div")).append("The token has expired"),t(e,n)},onError:e=>{console.log("on error",e)}}),window.onload=function(){document.getElementById("register").onclick=function(){e=document.getElementById("userID").value.toString(),n=document.getElementById("password").value.toString(),o("https://a41.chat.agora.io/app/chat/user/register",{userAccount:e,userPassword:n}).then((n=>{document.getElementById("log").appendChild(document.createElement("div")).append(`register user ${e} success`)})).catch((n=>{document.getElementById("log").appendChild(document.createElement("div")).append(`${e} already exists`)}))},document.getElementById("login").onclick=function(){document.getElementById("log").appendChild(document.createElement("div")).append("Logging in..."),e=document.getElementById("userID").value.toString(),n=document.getElementById("password").value.toString(),o("https://a41.chat.agora.io/app/chat/user/login",{userAccount:e,userPassword:n}).then((e=>{let n=e.accessToken,t=e.chatUserName;WebIM.conn.open({user:t,agoraToken:n})})).catch((e=>{document.getElementById("log").appendChild(document.createElement("div")).append("Login failed")}))},document.getElementById("logout").onclick=function(){WebIM.conn.close(),document.getElementById("log").appendChild(document.createElement("div")).append("logout")},document.getElementById("send_peer_message").onclick=function(){let e=document.getElementById("peerId").value.toString(),n=document.getElementById("peerMessage").value.toString(),t={chatType:"singleChat",type:"txt",to:e,msg:n},o=WebIM.message.create(t);WebIM.conn.send(o).then((t=>{console.log("send private text success"),document.getElementById("log").appendChild(document.createElement("div")).append("Message send to: "+e+" Message: "+n)})).catch((()=>{console.log("send private text fail")}))}},s})();